!function(d){var t={$buttons:null,$container:null,$ui:null,attempt_key:null,current_question:0,total_questions:0,questions:{},validators:{},status:null,resumable:null,exiting_quiz:!1,bind:function(){var e=this;d("#llms_start_quiz").on("click",function(t){t.preventDefault(),e.start_quiz()}),d("#llms_resume_quiz").on("click",function(t){t.preventDefault(),e.resume_quiz()}),d(".llms-donut").each(function(){LLMS.Donut(d(this))}),d("#llms-quiz-attempt-select").on("change",function(){var t=d(this).val();t&&(window.location.href=t)}),d(window).on("beforeunload",function(){if(e.status&&!e.exiting_quiz)return LLMS.l10n.translate("Are you sure you wish to quit this quiz attempt?")}),d(window).on("unload",function(){e.status&&!e.resumable&&e.complete_quiz()}),d(document).on("llms-post-append-question",e.post_append_question),this.register_validator("content",this.validate),this.register_validator("choice",this.validate_choice),this.register_validator("picture_choice",this.validate_choice),this.register_validator("true_false",this.validate_choice)},add_error:function(t){var e=this,e=(e.$container.find("#llms-quiz-error-container").remove(),e.$container.append('<div id="llms-quiz-error-container" role="alert" aria-atomic="true"></div>'),e.$container.find("#llms-quiz-error-container")),i=d('<p class="llms-error">'+t+'<a href="#"><i class="fa fa-times-circle" aria-hidden="true"></i></a></p>');i.on("click","a",function(t){t.preventDefault(),i.fadeOut("200"),setTimeout(function(){i.remove()},210)}),e.append(i)},save_question:function(e){var t=this.$container.find(".llms-question-wrapper"),i=t.attr("data-type");this.validators[i]?(t={action:"quiz_answer_question",answer:this.validators[i](t).answer,attempt_key:this.attempt_key,question_id:t.attr("data-id"),question_type:t.attr("data-type")},e&&e.exit_quiz&&(t.via_exit_quiz=!0),e&&e.previous_question&&(t.via_previous_question=!0),LLMS.Ajax.call({data:t,success:function(t){e&&"function"==typeof e.callback&&e.callback()}})):console.log("No validator registered for question type "+i)},answer_question:function(e){var t,n=this,i=this.$container.find(".llms-question-wrapper"),s=i.attr("data-type");if(this.validators[s]){if(!(t=this.validators[s](i))||!0!==t.valid||!t.answer)return n.add_error(t.valid);LLMS.Ajax.call({data:{action:"quiz_answer_question",answer:t.answer,attempt_key:n.attempt_key,question_id:i.attr("data-id"),question_type:i.attr("data-type")},beforeSend:function(){var t=e.hasClass("llms-button-quiz-complete")?LLMS.l10n.translate("Grading Quiz..."):LLMS.l10n.translate("Loading Question...");n.toggle_loader("show",t),n.update_progress_bar("increment")},success:function(t){n.toggle_loader("hide"),t.data&&t.data.html?t.data.question_id&&n.questions["q-"+t.data.question_id]?n.load_question(n.questions["q-"+t.data.question_id]):n.load_question(t.data.html):t.data&&t.data.redirect?n.redirect(t.data.redirect):t.message?n.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),n.$container.append("<p>"+t+"</p>"))},error:function(t,e,i){n.reload_question(),n.add_error(LLMS.l10n.translate("An unknown error occurred. Please try again.")),console.log(i)}})}else console.log("No validator registered for question type "+s)},complete_quiz:function(){var e=this;LLMS.Ajax.call({data:{action:"quiz_end",attempt_key:e.attempt_key},beforeSend:function(){e.toggle_loader("show","Grading Quiz...")},success:function(t){e.toggle_loader("hide"),t.data&&t.data.redirect?e.redirect(t.data.redirect):t.message?e.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),e.$container.append("<p>"+t+"</p>"))}})},get_question_index:function(t){return Object.keys(this.questions).indexOf("q-"+t)},redirect:function(t){this.toggle_loader("show","Grading Quiz..."),this.status=null,window.location.href=t},reload_question:function(){var t=this;t.toggle_loader("show",LLMS.l10n.translate("Loading Question...")),t.update_progress_bar("reload"),setTimeout(function(){t.toggle_loader("hide"),t.load_question(t.questions["q-"+t.current_question])},100)},previous_question:function(){var n=this;this.save_question({previous_question:!0,callback:function(){n.toggle_loader("show",LLMS.l10n.translate("Loading Question...")),n.update_progress_bar("decrement");var t=Object.keys(n.questions),e=t.indexOf("q-"+n.current_question),i=t[0];1<=e&&(i=t[e-1]),n.questions[i]?setTimeout(function(){n.toggle_loader("hide"),n.load_question(n.questions[i])},100):LLMS.Ajax.call({data:{action:"quiz_get_question",attempt_key:n.attempt_key,question_id:i.substring(2)},success:function(t){n.toggle_loader("hide"),t.data&&t.data.html?n.load_question(t.data.html):t.data&&t.data.redirect?n.redirect(t.data.redirect):t.message?n.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),n.$container.append("<p>"+t+"</p>"))}})}})},register_validator:function(t,e){this.validators[t]=e},start_quiz:function(){this.init_quiz("quiz_start")},resume_quiz:function(){this.init_quiz("quiz_resume")},init_quiz:function(e){var i=this;"quiz_resume"===e&&d("#llms_resume_quiz").attr("disabled","disabled"),this.load_ui_elements(),this.$ui=d("#llms-quiz-ui"),this.$buttons=d("#llms-quiz-nav button"),this.$container=d("#llms-quiz-question-wrapper"),d("#llms-next-question, #llms-complete-quiz").on("click",function(t){t.preventDefault(),i.answer_question(d(this))}),d("#llms-prev-question").on("click",function(t){t.preventDefault(),i.previous_question()}),d("#llms-quiz-nav").on("click","#llms-exit-quiz",function(t){t.preventDefault(),i.save_question({exit_quiz:!0,callback:function(){i.exiting_quiz=!0,window.location.reload()}})}),data="quiz_resume"===e?{action:"quiz_resume",attempt_key:d("#llms-attempt-key").val()}:{action:"quiz_start",attempt_key:d("#llms-attempt-key").val(),lesson_id:d("#llms-lesson-id").val(),quiz_id:d("#llms-quiz-id").val()},LLMS.Ajax.call({data:data,beforeSend:function(){i.status=!0,d("#llms-quiz-wrapper, #quiz-start-button, #quiz-resume-button").remove(),d("html, body").stop().animate({scrollTop:0},500),i.toggle_loader("show",LLMS.l10n.translate("Loading Quiz..."))},error:function(t,e,i){console.log(t,e,i)},success:function(t){i.toggle_loader("hide"),t.data&&t.data.html?(i.attempt_key=t.data.attempt_key,i.total_questions=t.data.total,i.resumable=t.data.can_be_resumed,"quiz_resume"===e?t.data.question_ids.forEach(t=>i.questions["q-"+t]=""):t.data.time_limit&&i.start_quiz_timer(t.data.time_limit),i.resumable&&d("#llms-quiz-nav").append('<button class="button llms-button-secondary" id="llms-exit-quiz" name="llms_exit_quiz">'+LLMS.l10n.translate("Save & Exit Quiz")+"</button>"),i.load_question(t.data.html),"quiz_resume"===e&&i.update_progress_bar("reload")):t.message?i.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),i.$container.append("<p>"+t+"</p>"))}}),LLMS.is_touch_device()||(this.$ui.on("mouseenter","li.llms-choice label",function(){d(this).addClass("hovered")}),this.$ui.on("mouseleave","li.llms-choice label",function(){d(this).removeClass("hovered")}))},start_quiz_timer:function(t){var e=d('<div class="llms-quiz-timer" id="llms-quiz-timer" />'),i=LLMS.l10n.translate("Time Remaining"),i=(e.append('<i class="fa fa-clock-o" aria-hidden="true"></i><span class="screen-reader-text">'+i+"</span>"),d("#llms-quiz-header")),n=(e.append('<time aria-describedby="llms-timer-hint" id="llms-quiz-time-remaining" class="llms-tiles" datetime=""></time>'),i.append(e),i.append('<div id="llms-timer-live" class="sr-only" aria-live="polite" aria-atomic="true"></div>'),i.append('<p id="llms-timer-hint" class="sr-only">Announcements every minute; every 10 seconds in the last minute.</p>'),this),s=(new Date).getTime()+60*t*1e3,a=60*t*1e3,o=document.getElementById("llms-quiz-time-remaining");setTimeout(function(){n.complete_quiz()},1e3+a),this.getCountdown(t,s,a,void 0,void 0,void 0,void 0,o),setInterval(function(){n.getCountdown(t,s,a,void 0,void 0,void 0,void 0,o)},1e3)},trigger:function(t){"answer_question"===t&&(this.get_question_index(this.current_question)===this.total_questions?d("#llms-complete-quiz"):d("#llms-next-question")).trigger("click")},load_question:function(t){var t=d(t),e=t.attr("data-id");this.questions["q-"+e]||(this.questions["q-"+e]=t),this.update_progress(e),this.current_question=e,d(document).trigger("llms-pre-append-question",t),this.$container.append(t),d(document).trigger("llms-post-append-question",t)},load_ui_elements:function(){0<d("#llms-quiz-ui").length&&d("#llms-quiz-ui").remove();var t=d('<div class="llms-quiz-ui" id="llms-quiz-ui" />'),e=d('<header class="llms-quiz-header" id="llms-quiz-header" />');($footer=d('<footer class="llms-quiz-nav" id="llms-quiz-nav" />')).append('<button class="button large llms-button-action" id="llms-next-question" name="llms_next_question" type="submit">'+LLMS.l10n.translate("Next Question")+"</button>"),$footer.append('<button class="button large llms-button-action llms-button-quiz-complete" id="llms-complete-quiz" name="llms_complete_quiz" type="submit" style="display:none;">'+LLMS.l10n.translate("Complete Quiz")+"</button>"),$footer.append('<button class="button llms-button-secondary" id="llms-prev-question" name="llms_prev_question" type="submit" style="display:none;">'+LLMS.l10n.translate("Previous Question")+"</button>"),e.append('<div class="llms-progress"><div class="progress-bar-complete"></div></div>'),$footer.append('<div class="llms-quiz-counter" id="llms-quiz-counter"><span class="llms-current"></span><span class="llms-sep">/</span><span class="llms-total"></span></div>'),t.append(e).append('<div class="llms-quiz-question-wrapper" id="llms-quiz-question-wrapper" />').append($footer),d("#llms-quiz-wrapper").after(t)},post_append_question:function(t,e){d(e).find("audio").length&&wp.mediaelement.initialize()},toggle_loader:function(t,e){"show"===t?(e=e||LLMS.l10n.translate("Loading..."),this.$buttons.attr("disabled","disabled"),this.$container.empty(),LLMS.Spinner.start(this.$container),this.$container.append('<div class="llms-quiz-loading">'+LLMS.l10n.translate(e)+"</div>")):(LLMS.Spinner.stop(this.$container),this.$buttons.removeAttr("disabled"),this.$container.find(".llms-quiz-loading").remove())},update_progress:function(t){t=this.get_question_index(t);-1!==t&&(t++,d("#llms-quiz-counter .llms-current").text(t),0<t&&!d("#llms-quiz-counter .llms-total").text()&&(d("#llms-quiz-counter .llms-total").text(this.total_questions),d("#llms-quiz-counter").show()),2<=t?d("#llms-prev-question").show():d("#llms-prev-question").hide(),t===this.total_questions?(d("#llms-next-question").hide(),d("#llms-complete-quiz").show()):(d("#llms-next-question").show(),d("#llms-complete-quiz").hide()))},update_progress_bar:function(t){var e=this.get_question_index(this.current_question);switch(t){case"increment":e++;break;case"decrement":e--}progress=e/this.total_questions*100,this.$ui.find(".progress-bar-complete").css("width",progress+"%")},getCountdown:function(t,e,i,n,s,a,o,l){var r=(new Date).getTime(),e=parseInt((e-r)/1e3);const u=document.getElementById("llms-timer-live");0<=e&&(1e3*e<i/2&&d("#llms-quiz-timer").addClass("color-half"),1e3*e<i/4&&(d("#llms-quiz-timer").removeClass("color-half"),d("#llms-quiz-timer").addClass("color-empty")),parseInt(e/86400),r=e%86400,s=parseInt(r/3600),r=e%3600,a=parseInt(r/60),o=parseInt(r%60),l.innerHTML=this.pad(s)+":"+this.pad(a)+":"+this.pad(o),d(l).attr("datetime","PT"+(0<s?s+"H":"")+(0<a?a+"M":"")+(0<o?o+"S":"")),(r=e)!==parseInt(i/1e3)&&!(r<=10||(r<=60?r%10==0:r%60==0))||(l=a,e=o,0<(i=s)?u.textContent=1<i?LLMS.l10n.replace("%1$s hours, %2$s minutes remaining",{"%1$s":i,"%2$s":l}):LLMS.l10n.replace("1 hour, %2$s minutes remaining",{"%2$s":l}):0<l&&0===e?u.textContent=1<l?LLMS.l10n.replace("%1$s minutes remaining",{"%1$s":l}):LLMS.l10n.replace("%1$s minute remaining",{minutes:l}):0===l&&(u.textContent=LLMS.l10n.replace("%1$s seconds remaining",{"%1$s":e}))))},pad:function(t){return(t<10?"0":"")+t},validate:function(t){return{answer:[],valid:!0}},validate_choice:function(t){var e=window.llms.quizzes.validate(t),t=t.find("input:checked");return t.length?t.each(function(){e.answer.push(d(this).val())}):e.valid=LLMS.l10n.translate("You must select an answer to continue."),e}};t.bind(),window.llms=window.llms||{},window.llms.quizzes=t}(jQuery);
//# sourceMappingURL=../maps/js/llms-quiz.min.js.map
